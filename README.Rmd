---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# emlogit

<!-- badges: start -->
[![Build Status](https://travis-ci.com/soichiroy/emlogit.svg?token=9kDL249kRuSq995JxCG8&branch=master)](https://travis-ci.com/soichiroy/emlogit)
<!-- badges: end -->

`emlogit` is a **R** package that implements the Expectation and Conditional-Maximization (ECM) algorithm for the multinomial logistic regression.


## Table of Contents

1. [Installation](#installation)
2. [Examples](#examples)

    a. [Categorical outcome](#categorical-outcome)
    b. [Multinomial outcome](#multinomial-outcome)
    c. [Binary (binomial) outcome (logit)](#binary-outcome)


## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("soichiroy/emlogit")
```

## Examples

### Categorical outcome

`Car` data from `mlogit` package.

```{r warning = FALSE, message = FALSE}
require(emlogit)
require(dplyr)
data(Car, package = 'mlogit')

## prepare data: only allow for indiviual specific covariates
y <- Car %>% select(choice)
Y <- model.matrix(~choice-1, data = y)
X <- Car %>% select(college, hsg2, coml5) %>% data.matrix()
```

```{r}
## fit
fit <- emlogit(Y = Y, X = X)
summary(fit)

## predicted probability
prob <- predict(fit)
```

```{r}
head(prob) %>%
  knitr::kable(digit = 3)
```

### Multinomial outcome

`japan` data from `MNP` package.

```{r}
## multinomial outcome
data(japan, package = "MNP")
head(japan)

Y <- japan %>% select(LDP, NFP, SKG, JCP) %>% data.matrix()
X <- japan %>% select(gender, education, age) %>% data.matrix()

set.seed(1234)
fit <- emlogit(Y = Y, X = X)
summary(fit)

pred <- predict(fit)
```

```{r}
head(pred) %>%
  knitr::kable(digit = 3)
```


### Binary outcome

Since the binomial outcome is a special case of multinomial outcomes,
`emlogit` can handle the binomial outcome.


```{r}
set.seed(1234)

## generate X and pi(X)
betas <- rnorm(4)
X     <- MASS::mvrnorm(5000, mu = rep(0, length(betas)), Sigma = diag(length(betas)))

prob  <- 1 / (1 + exp(- 0.5 - X %*% betas))

## generate outcome
ybin <- rbinom(n = 5000, size = 1, prob = prob)
Y    <- model.matrix(~ factor(ybin) - 1)

## fit
fit <- emlogit(Y = Y, X = X)


## check
betas <- c(0.5, betas)
cbind(true = betas, estimate = summary(fit)$estimate) %>%
  knitr::kable(digit = 3)
```
